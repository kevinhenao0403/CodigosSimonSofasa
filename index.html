<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Listado de equipos Soldadura</title>
  <!-- BUILD v6-mobile-GMAO -->
  <style>
    :root { --bg:#0b0f14; --card:#11161d; --muted:#8fa3b7; --text:#e8f0f7; --radius:16px; }
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:linear-gradient(180deg,var(--bg),#0e141b 40%,#0b1118 100%); color:var(--text); }
    .wrap{ max-width:1100px; margin:24px auto; padding:0 16px 40px; }
    header{ margin-bottom:16px; }
    h1{ font-size:20px; margin:0 0 10px; }
    .meta{ color:var(--muted); font-size:12px; margin:6px 0 12px; display:flex; gap:8px; align-items:center; }
    .pill{ padding:4px 8px; border-radius:999px; background:rgba(45,212,191,.12); border:1px solid rgba(45,212,191,.35); color:#bff3ea; }
    .searchbar{ display:grid; gap:8px; grid-template-columns:1fr; align-items:center; background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:var(--radius); padding:8px; position:sticky; top:8px; z-index:5; }
    #q{ width:100%; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:#0d131a; color:#e8f0f7; }
    .table-card{ background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:var(--radius); overflow:hidden; }
    table{ width:100%; border-collapse:collapse; }
    thead th{ text-align:left; font-weight:600; color:var(--muted); padding:12px; background:#0d131a; position:sticky; top:64px; z-index:4; }
    tbody td{ padding:12px; border-top:1px solid rgba(255,255,255,.06); }
    tbody tr:hover{ background:rgba(255,255,255,.02); }
    .empty{ text-align:center; padding:28px; color:var(--muted); }
    .copy-btn{ padding:8px 10px; border:1px solid rgba(255,255,255,.12); background:#0d131a; color:#e8f0f7; border-radius:10px; cursor:pointer; font-size:12px }
    .copy-btn:hover{ filter:brightness(1.12) }
    .toast{ position:fixed; left:50%; bottom:18px; transform:translateX(-50%); background:#11161d; color:#e8f0f7; padding:10px 14px; border-radius:999px; border:1px solid rgba(255,255,255,.18); box-shadow:0 8px 20px rgba(0,0,0,.35); font-size:13px; opacity:0; pointer-events:none; transition:opacity .18s ease }
    .toast.show{ opacity:1 }

    /* ===== Vista m√≥vil: filas como tarjetas ===== */
    @media (max-width: 720px){
      thead{ display:none; }
      table, tbody, tr, td{ display:block; width:100%; }
      tbody tr{ border-top:1px solid rgba(255,255,255,.06); padding:6px 12px; }
      tbody td{ border:0; padding:8px 0; }
      tbody td::before{
        content: attr(data-label);
        display:block;
        font-size:12px; color:var(--muted); margin-bottom:4px;
      }
      td[data-label="Acci√≥n"] .copy-btn{ width:100%; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Listado de equipos Soldadura</h1>
      <div class="meta">
        <span id="count" class="pill">‚Äî</span>
        <span id="msg"></span>
      </div>
      <div class="searchbar">
        <input id="q" type="search" placeholder="üîé Buscar por equipo, denominaci√≥n o GMAO‚Ä¶" autocomplete="off" />
      </div>
    </header>

    <div class="table-card">
      <table>
        <thead><tr><th style="width:18%">Equipo</th><th>Denominaci√≥n</th><th style="width:22%">GMAO</th><th style="width:120px">Copiar</th></tr></thead>
        <tbody id="rows"></tbody>
      </table>
      <div id="empty" class="empty" hidden>No hay resultados para tu b√∫squeda.</div>
    </div>
  </div>

  <!-- Respaldo m√≠nimo: si el CSV falla nunca ver√°s la tabla vac√≠a -->
  <script id="embeddedCSV" type="text/csv">Equipo,Denominaci√≥n,GMAO
EJ-001,Ejemplo equipo,123
EJ-002,Otro ejemplo,456
</script>

  <script>
    // Normaliza texto: quita acentos, min√∫sculas, compacta espacios y recorta
    const norm = s => (s ?? '')
      .toString()
      .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
      .toLowerCase()
      .replace(/\s+/g, ' ')
      .trim();

    const clean = s => (s||'').replace(/^\uFEFF/, '').trim(); // quita BOM

    function toast(msg){
      let t=document.getElementById('toast');
      if(!t){ t=document.createElement('div'); t.id='toast'; t.className='toast'; document.body.appendChild(t); }
      t.textContent=msg; t.classList.add('show');
      clearTimeout(window._t); window._t=setTimeout(()=>t.classList.remove('show'), 1200);
    }
    async function copyText(val){
      try { await navigator.clipboard.writeText(val); toast('Equipo copiado'); }
      catch(e){
        const ta=document.createElement('textarea'); ta.value=val; ta.style.position='fixed'; ta.style.opacity='0';
        document.body.appendChild(ta); ta.focus(); ta.select();
        try{ document.execCommand('copy'); toast('Equipo copiado'); }catch(_){ toast('No se pudo copiar'); }
        document.body.removeChild(ta);
      }
    }

    function parseCSV(text){
      const lines = (text||'').split(/\r?\n/).map(clean).filter(x=>x.length>0);
      if(!lines.length) return [];
      const header = clean(lines[0]);
      const commas=(header.match(/,/g)||[]).length, semis=(header.match(/;/g)||[]).length;
      const DELIM = semis > commas ? ';' : ',';
      const h = header.toLowerCase().replace(/\s+/g,'');
      const isHeader = h.includes('equipo') && h.includes('denomin') && h.includes('gmao');
      const startIdx = isHeader ? 1 : 0;

      const out=[];
      for(let i=startIdx;i<lines.length;i++){
        const line=lines[i];
        const row=[]; let cur='', quoted=false;
        for(let j=0;j<line.length;j++){
          const ch=line[j];
          if(ch === '"'){ if(quoted && line[j+1] === '"'){ cur+='"'; j++; } else { quoted=!quoted; } }
          else if(ch === DELIM && !quoted){ row.push(cur); cur=''; }
          else { cur += ch; }
        }
        row.push(cur);
        if(row.length>=3){
          const eq=(row[0]||'').trim(), de=(row[1]||'').trim(), gm=(row[2]||'').trim();
          if(eq || de || gm) out.push({equipo:eq, deno:de, gmao:gm});
        }
      }
      return out;
    }

    let DATA=[];

    function render(list){
      const tbody=document.getElementById('rows');
      tbody.innerHTML='';
      for(const r of list){
        const tr=document.createElement('tr');

        const td1=document.createElement('td'); td1.textContent=r.equipo; td1.setAttribute('data-label','Equipo');
        const td2=document.createElement('td'); td2.textContent=r.deno;   td2.setAttribute('data-label','Denominaci√≥n');
        const td3=document.createElement('td'); td3.textContent=r.gmao;   td3.setAttribute('data-label','GMAO');

        const td4=document.createElement('td'); td4.setAttribute('data-label','Acci√≥n');
        const btn=document.createElement('button'); btn.className='copy-btn'; btn.textContent='Copiar equipo';
        btn.addEventListener('click', ()=> copyText(r.equipo));
        td4.appendChild(btn);

        tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3); tr.appendChild(td4);
        tbody.appendChild(tr);
      }
      document.getElementById('empty').hidden = list.length !== 0;
      document.getElementById('count').textContent=`${list.length} resultado${list.length===1?'':'s'}`;
    }

    function applyFilter(){
      const q = document.getElementById('q').value;
      const nq = norm(q);
      if (!nq){ render(DATA); return; }
      // Busca por palabras (todas deben estar presentes en alguna columna)
      const tokens = nq.split(' ');
      const filtered = DATA.filter(r => {
        const hay = norm(`${r.equipo} ${r.deno} ${r.gmao||''}`);
        return tokens.every(t => hay.includes(t));
      });
      render(filtered);
    }

    async function loadData(){
      const msg = document.getElementById('msg');
      try{
        const res=await fetch('data.csv?cb='+Date.now(), {cache:'no-store'});
        if(!res.ok) throw 0;
        const txt=await res.text();
        DATA=parseCSV(txt);
        if(!Array.isArray(DATA) || DATA.length===0){
          const fb=document.getElementById('embeddedCSV').textContent;
          const p=parseCSV(fb);
          if(p.length>0){ DATA=p; msg.textContent='Usando datos de respaldo.'; }
        }else{
          msg.textContent='Datos cargados desde data.csv';
        }
      }catch(e){
        const fb=document.getElementById('embeddedCSV').textContent;
        DATA=parseCSV(fb);
        msg.textContent='No se pudo leer data.csv ‚Äî usando respaldo.';
      }
      const urlQ=new URL(location.href).searchParams.get('q')||'';
      document.getElementById('q').value=urlQ;
      applyFilter();
    }

    // Eventos
    document.getElementById('q').addEventListener('input',()=>{clearTimeout(window._deb); window._deb=setTimeout(applyFilter,120);});
    document.getElementById('q').addEventListener('blur',(e)=>{ e.target.value = norm(e.target.value); });

    loadData();
  </script>
</body>
</html>
