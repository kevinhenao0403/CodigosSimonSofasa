<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Listado filtrable ‚Äî Equipo / Denominaci√≥n</title>
  <meta name="description" content="Listado de dos columnas con buscador r√°pido, pensado para abrir desde c√≥digo QR en el celular. Sin login, sin apps." />
  <style>
    :root { --bg:#0b0f14; --card:#11161d; --muted:#8fa3b7; --text:#e8f0f7; --radius:16px; }
    html,body{height:100%}
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:linear-gradient(180deg,var(--bg),#0e141b 40%,#0b1118 100%); color:var(--text); }
    .wrap{ max-width:900px; margin:24px auto; padding:0 16px 40px; }
    header{ display:grid; gap:10px; margin-bottom:16px; }
    h1{ font-size:20px; margin:0 0 10px; }
    .searchbar{ display:grid; gap:8px; grid-template-columns:1fr auto auto; align-items:center; background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:var(--radius); padding:8px; position:sticky; top:8px; z-index:5; backdrop-filter:blur(6px); }
    #q{ width:100%; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:#0d131a; color:var(--text); outline:none; }
    .btn{ padding:10px 12px; border:1px solid rgba(255,255,255,.08); background:#0d131a; color:var(--text); border-radius:12px; cursor:pointer; }
    .table-card{ background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:var(--radius); overflow:hidden; }
    table{ width:100%; border-collapse:collapse; }
    thead th{ text-align:left; font-weight:600; color:var(--muted); padding:12px; background:#0d131a; position:sticky; top:64px; z-index:2; }
    tbody td{ padding:12px; border-top:1px solid rgba(255,255,255,.06); }
    tbody tr:hover{ background:rgba(255,255,255,.02); }
    .meta{ display:flex; gap:12px; align-items:center; color:var(--muted); font-size:12px; margin:6px 0 14px; }
    .pill{ padding:4px 8px; border-radius:999px; background:rgba(45,212,191,.12); border:1px solid rgba(45,212,191,.35); color:#bff3ea; }
    .empty{ text-align:center; padding:28px; color:var(--muted); }
    .footer{ color:var(--muted); font-size:12px; margin-top:14px; text-align:center; }
    @media (max-width:640px){ thead th{ top:88px; } .searchbar{ grid-template-columns:1fr; top:0; } .btn{ width:100%; } }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Listado filtrable ‚Äî <span style="color:#2dd4bf">Equipo</span> / <span style="color:#60a5fa">Denominaci√≥n</span></h1>
      <div class="meta">
        <span id="count" class="pill">‚Äî</span>
        <span>Busca por cualquier palabra en una o ambas columnas. Acentos y may√∫sculas no afectan la b√∫squeda.</span>
      </div>
      <div class="searchbar">
        <input id="q" type="search" placeholder="üîé Buscar por equipo o denominaci√≥n‚Ä¶" autocomplete="off" />
        <button class="btn" id="clearBtn" title="Limpiar b√∫squeda">Limpiar</button>
        <button class="btn" id="shareBtn" title="Copiar link para compartir">Compartir</button>
      </div>
    </header>

    <div class="table-card">
      <table>
        <thead><tr><th style="width:36%">Equipo</th><th>Denominaci√≥n</th></tr></thead>
        <tbody id="rows"></tbody>
      </table>
      <div id="empty" class="empty" hidden>No hay resultados para tu b√∫squeda.</div>
    </div>

    <div class="footer">
      <p>Para actualizar la lista, sube un archivo <em>data.csv</em> junto a este HTML (2 columnas: <strong>Equipo,Denominaci√≥n</strong>).</p>
    </div>
  </div>

  <script>
    const norm = s => (s||'').toString().normalize('NFD').replace(/[\\u0300-\\u036f]/g,'').toLowerCase();

    // Parse CSV auto-detecting delimiter
    function parseCSV(text){
      const lines = (text||'').trim().split(/\\r?\\n/);
      if(!lines.length) return [];
      const header = lines[0] || '';
      const commas = (header.match(/,/g)||[]).length;
      const semis  = (header.match(/;/g)||[]).length;
      const DELIM = semis > commas ? ';' : ',';
      const out = [];
      const startIdx = header.toLowerCase().startsWith('equipo'+DELIM) ? 1 : 0;
      for(let i=startIdx;i<lines.length;i++){
        const row = [];
        let cur = '', quoted = false;
        for(let j=0;j<lines[i].length;j++){
          const ch = lines[i][j];
          if(ch === '\"'){
            if(quoted && lines[i][j+1] === '\"'){ cur += '\"'; j++; }
            else { quoted = !quoted; }
          } else if(ch === DELIM && !quoted){
            row.push(cur); cur = '';
          } else { cur += ch; }
        }
        row.push(cur);
        if(row.length >= 2){ out.push({ equipo: (row[0]||'').trim(), deno: (row[1]||'').trim() }); }
      }
      return out;
    }

    let DATA = [];

    function render(list){
      const tbody = document.getElementById('rows');
      tbody.innerHTML = '';
      for(const r of list){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r.equipo}</td><td>${r.deno}</td>`;
        tbody.appendChild(tr);
      }
      document.getElementById('empty').hidden = list.length !== 0;
      document.getElementById('count').textContent = `${list.length} resultado${list.length===1?'':'s'}`;
    }

    function applyFilter(){
      const q = document.getElementById('q').value;
      const nq = norm(q);
      const filtered = !nq ? DATA : DATA.filter(r => norm(r.equipo).includes(nq) || norm(r.deno).includes(nq));
      render(filtered);
      const url = new URL(location.href);
      if(q) url.searchParams.set('q', q); else url.searchParams.delete('q');
      history.replaceState(null, '', url);
    }

    async function loadData(){
      try{
        const res = await fetch('data.csv?cb=' + Date.now(), { cache:'no-store' });
        if(!res.ok) throw 0;
        const txt = await res.text();
        DATA = parseCSV(txt);
      }catch(e){
        DATA = [];
      }
      const urlQ = new URL(location.href).searchParams.get('q') || '';
      const qEl = document.getElementById('q');
      qEl.value = urlQ;
      applyFilter();
    }

    document.getElementById('clearBtn').addEventListener('click', () => { document.getElementById('q').value=''; applyFilter(); document.getElementById('q').focus(); });
    document.getElementById('shareBtn').addEventListener('click', async () => {
      try{ await navigator.clipboard.writeText(location.href); const b=document.getElementById('shareBtn'); const t=b.textContent; b.textContent='¬°Link copiado!'; setTimeout(()=>b.textContent=t,1200);}catch{ alert('Copia el link desde la barra del navegador.'); }
    });
    document.getElementById('q').addEventListener('input', () => { clearTimeout(window._deb); window._deb=setTimeout(applyFilter,120); });

    loadData();
  </script>
</body>
</html>

